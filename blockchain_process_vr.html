<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>How Blockchain Works - VR Demo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script>
      const steps = [
        {
          title: "Transaction Requested",
          text: "A user initiates a transaction â€” for example, sending cryptocurrency or recording data on the blockchain.",
          color: "#00E5FF",
        },
        {
          title: "Transaction Broadcasted",
          text: "The transaction is broadcast to a peer-to-peer network consisting of computers, known as nodes.",
          color: "#03A9F4",
        },
        {
          title: "Nodes Validate Transaction",
          text: "The network of nodes validates the transaction using consensus algorithms, ensuring authenticity.",
          color: "#4CAF50",
        },
        {
          title: "Verified Transaction",
          text: "Once verified, the transaction is combined with others to form a new block of data.",
          color: "#8BC34A",
        },
        {
          title: "New Block Created",
          text: "The new block is created and added to the chain in a way that is permanent and unalterable.",
          color: "#FFC107",
        },
        {
          title: "Block Added to Blockchain",
          text: "The block is linked to the previous one using cryptographic hashes, securing the chain.",
          color: "#FF9800",
        },
        {
          title: "Transaction Completed",
          text: "The transaction is complete. The blockchain is updated and visible to all participants in the network.",
          color: "#E91E63",
        },
      ];

      let stepIndex = 0;

      function speak(text) {
        const msg = new SpeechSynthesisUtterance(text);
        msg.lang = "en-US";
        msg.pitch = 1.1;
        msg.rate = 1.05;
        msg.volume = 1;
        msg.voice = speechSynthesis.getVoices().find(v => v.name.includes("Google") || v.lang === "en-US");
        speechSynthesis.speak(msg);
      }

      function updateScene() {
        const step = steps[stepIndex];
        const title = document.querySelector("#titleText");
        const info = document.querySelector("#infoText");
        const sphere = document.querySelector("#mainSphere");
        const bg = document.querySelector("a-scene");

        title.setAttribute("value", step.title);
        info.setAttribute("value", step.text);
        sphere.setAttribute("color", step.color);
        bg.setAttribute("background", "color: #050510");

        // voice only for titles
        speak(step.title);

        // subtle pulse animation
        sphere.setAttribute(
          "animation",
          "property: scale; to: 1.2 1.2 1.2; dur: 1000; dir: alternate; loop: true"
        );

        stepIndex = (stepIndex + 1) % steps.length;
      }

      window.onload = () => {
        updateScene();
        setInterval(updateScene, 7000); // change every 7s
      };
    </script>
  </head>

  <body>
    <a-scene background="color: #050510" vr-mode-ui="enabled: true">
      <!-- Lighting -->
      <a-entity light="type: ambient; color: #999"></a-entity>
      <a-entity light="type: point; intensity: 2" position="0 3 3"></a-entity>

      <!-- Camera -->
      <a-entity id="cameraRig" position="0 1.6 3">
        <a-camera look-controls="true" wasd-controls="false"></a-camera>
      </a-entity>

      <!-- Floating particle-like sphere -->
      <a-sphere id="mainSphere" color="#00E5FF" radius="1" position="0 1.5 -3"
                animation="property: rotation; to: 0 360 0; loop: true; dur: 8000"></a-sphere>

      <!-- Floating title -->
      <a-text id="titleText" value="How Blockchain Works" color="#00E5FF"
              position="-2 3 -3" width="6" font="mozillavr"></a-text>

      <!-- Info text -->
      <a-text id="infoText" value="Loading process..."
              color="#FFF" position="-2 0.3 -2.5" width="6" wrap-count="60"></a-text>

      <!-- Ground -->
      <a-plane rotation="-90 0 0" width="10" height="10" color="#111"></a-plane>

      <!-- Decorative glowing ring -->
      <a-ring color="#00E5FF" radius-inner="1" radius-outer="1.2" position="0 1.5 -3"
              animation="property: rotation; to: 0 360 0; loop: true; dur: 9000"></a-ring>
    </a-scene>
  </body>
</html>
