<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>How Blockchain Works – Cardboard VR</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

    <style>
      body { margin: 0; overflow: hidden; background: black; }
    </style>
  </head>

  <body>
    <a-scene vr-mode-ui="enabled: true" background="color: #020510">

      <!-- ambient and point lighting -->
      <a-entity light="type: ambient; intensity: 0.6; color: #88f"></a-entity>
      <a-entity light="type: point; intensity: 2; color: #0ff" position="0 3 3"></a-entity>

      <!-- camera + gaze cursor -->
      <a-entity id="rig" position="0 1.6 0">
        <a-camera>
          <a-cursor 
            id="gazeCursor"
            color="#0ff"
            fuse="true"
            fuse-timeout="5000"
            geometry="primitive: ring; radius-inner: 0.01; radius-outer: 0.015"
            material="shader: flat">
          </a-cursor>
        </a-camera>
      </a-entity>

      <!-- neon ground grid -->
      <a-grid
        color="#00ffff"
        width="20"
        height="20"
        position="0 0 -5"
        rotation="-90 0 0"
        opacity="0.2">
      </a-grid>

      <!-- floating particles -->
      <a-entity id="particles">
        <a-entity
          particle-system="preset: dust; color: #00ffff,#00ccff,#ffffff; particleCount: 300; size: 0.05; opacity: 0.7">
        </a-entity>
      </a-entity>

      <!-- placeholder for stages -->
      <a-entity id="stage"></a-entity>
      <!-- SCRIPT: logic of narration and stage control -->
      <script>
        const stages = [
          {title:"Welcome",text:"Welcome to the Blockchain Journey. Look at NEXT to begin.",color:"#00ffff"},
          {title:"1. Transaction Requested",text:"A user requests a transaction, maybe sending cryptocurrency.",color:"#00e5ff"},
          {title:"2. Broadcast to Network",text:"The transaction is broadcast to a peer-to-peer network.",color:"#03a9f4"},
          {title:"3. Validation",text:"Nodes validate the transaction using consensus algorithms.",color:"#4caf50"},
          {title:"4. Verified",text:"The verified transaction joins others to form a new block.",color:"#8bc34a"},
          {title:"5. Block Created",text:"A new block is created and prepared for linking.",color:"#ffc107"},
          {title:"6. Added to Chain",text:"The new block is linked with cryptographic hashes.",color:"#ff9800"},
          {title:"7. Transaction Complete",text:"The blockchain is updated and transparent to all.",color:"#e91e63"},
          {title:"The End",text:"Process finished. Look at RESTART to experience again.",color:"#ffffff"}
        ];

        let index = 0;
        const synth = window.speechSynthesis;

        function speak(text){
          const msg = new SpeechSynthesisUtterance(text);
          msg.lang = "en-US";
          msg.pitch = 1.3;
          msg.rate = 1.05;
          msg.volume = 1;
          const v = synth.getVoices().find(v=>v.name.toLowerCase().includes("female")||v.name.includes("Google"));
          if(v) msg.voice = v;
          synth.cancel();
          synth.speak(msg);
        }

        function showStage(i){
          const s = stages[i];
          const stage = document.querySelector("#stage");
          stage.innerHTML = `
            <a-entity id="block${i}">
              <a-box color="${s.color}" opacity="0.6" depth="1.2" height="1.2" width="1.2"
                     material="metalness:0.8; roughness:0.2; emissive:${s.color}; emissiveIntensity:0.5;"
                     position="0 1.6 -3"
                     animation="property: rotation; to: 0 360 0; loop:true; dur:10000"></a-box>
              <a-text value="${s.title}" color="${s.color}" position="-1.5 3 -3" width="6"></a-text>
              <a-text value="${s.text}" color="#fff" position="-2 0.5 -3" width="6" wrap-count="60"></a-text>
              <a-entity id="nextBtn" geometry="primitive: plane; height:0.4; width:1"
                        material="color:${s.color}; opacity:0.8"
                        text="value:${i===stages.length-1?'Restart ⟳':'Next ➜'}; align:center"
                        position="0 -0.5 -2.8"
                        cursor="fuse:true; fuseTimeout:5000">
              </a-entity>
            </a-entity>`;
          speak(s.title);
          // attach listener
          setTimeout(()=>{
            const next = document.querySelector("#nextBtn");
            next.addEventListener("click",()=>{
              index = (index+1)%stages.length;
              showStage(index);
            });
          },500);
        }

        window.addEventListener("load",()=>{
          // preload voices
          speechSynthesis.onvoiceschanged = ()=>{};
          showStage(0);
        });
      </script>
      <!-- subtle glow sphere background -->
      <a-entity geometry="primitive: sphere; radius: 30" material="color: #041222; side: back; emissive: #002244; emissiveIntensity: 0.4; opacity: 0.5"
                animation="property: rotation; to: 0 360 0; loop: true; dur: 120000"></a-entity>

    </a-scene>
  </body>
</html>
